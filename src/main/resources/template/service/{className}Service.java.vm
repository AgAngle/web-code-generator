package ${package}.${moduleName}.service;

import io.cordys.common.util.BeanUtils;
import io.cordys.mybatis.BaseMapper;
import jakarta.annotation.Resource;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.util.List;
import io.cordys.common.exception.GenericException;
import io.cordys.common.uid.IDGenerator;
import io.cordys.common.service.BaseService;
import ${package}.${moduleName}.dto.request.*;
import ${package}.${moduleName}.dto.response.*;
import ${package}.${moduleName}.mapper.Ext${className}Mapper;
import ${package}.${moduleName}.domain.${className};

/**
 *
 * @author ${author}
 * @date ${datetime}
 */
@Service
@Transactional(rollbackFor = Exception.class)
public class ${className}Service {

    @Resource
    private BaseMapper<${className}> ${classname}Mapper;

    @Resource
    private Ext${className}Mapper ext${className}Mapper;

#if($extendBaseModel.equals("true"))
    @Resource
    private BaseService baseService;
#end

    public List<${className}ListResponse> list(${className}PageRequest request, String orgId) {
        List<${className}ListResponse> list = ext${className}Mapper.list(request, orgId);
        // do something...

#if($extendBaseModel.equals("true"))
        return baseService.setCreateAndUpdateUserName(list);
#else
        return list;
#end
    }


    public ${className}GetResponse get(String id) {
        ${className} ${classname} = ${classname}Mapper.selectByPrimaryKey(id);
        ${className}GetResponse ${classname}GetResponse = BeanUtils.copyBean(new ${className}GetResponse(), ${classname});
        // do something...
#if($extendBaseModel.equals("true"))
        return baseService.setCreateAndUpdateUserName(${classname}GetResponse);
#else
        return ${classname}GetResponse;
#end
    }

    public ${className} add(${className}AddRequest request, String userId, String orgId) {
        ${className} ${classname} = BeanUtils.copyBean(new ${className}(), request);
        ${classname}.setCreateTime(System.currentTimeMillis());
        ${classname}.setUpdateTime(System.currentTimeMillis());
        ${classname}.setUpdateUser(userId);
        ${classname}.setCreateUser(userId);
        ${classname}.setOrganizationId(orgId);
        ${classname}.setId(IDGenerator.nextStr());
        // 校验名称重复
        checkAddExist(${classname});
        ${classname}Mapper.insert(${classname});
        return ${classname};
    }

    public ${className} update(${className}UpdateRequest request, String userId) {
        ${className} ${classname} = BeanUtils.copyBean(new ${className}(), request);
        ${classname}.setUpdateTime(System.currentTimeMillis());
        ${classname}.setUpdateUser(userId);
        // 校验名称重复
        checkUpdateExist(${classname});
        ${classname}Mapper.update(${classname});
        return ${classname}Mapper.selectByPrimaryKey(${classname}.getId());
    }

    private void checkAddExist(${className} ${classname}) {
        if (ext${className}Mapper.checkAddExist(${classname})) {
            throw new GenericException(${CLASS_NAME}_EXIST);
        }
    }

    private void checkUpdateExist(${className} ${classname}) {
        if (ext${className}Mapper.checkUpdateExist(${classname})) {
            throw new GenericException(${CLASS_NAME}_EXIST);
        }
    }

    public void delete(String id) {
        ${classname}Mapper.deleteByPrimaryKey(id);
    }
}